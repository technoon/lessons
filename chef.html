
<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta name="keywords" content="chef, puppet, getchef, learnchef"/>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Technoon Tutorial - Chef</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/vendor/modernizr.js"></script>
  </head>
  <body>

  <div class="row">
    <div class="large-12 columns">
      <div class="nav-bar right">
       <ul class="button-group">
         <li><a href="http://technoon.github.io/lessons/" class="small button">Home</a></li>
         <li><a href="http://linkedin.com/in/vrkrajesh/" class="small button">About me</a></li>
        </ul>
      </div>
      <h1>Technoon <small>Tutorials <br> Chef - Infrastructure as a code</small></h1>
      <hr />
    </div>
  </div>

<!-- Main Page Content and Sidebar -->
 
<div class="row">

<!-- Main Blog Content -->
<div class="large-9 columns" role="content">
 
<article>
<h6>Written by <a href="#">Rajeshkumar Venkatesan</a> on Aug, 2014.</h6>

<div class="row">
  <div class="large-12 columns">
  <h4><a href="#">Preface</a></h4>
  <p>In this automation decade, we have seen many automation in software life cycle.  But chef brings in automation to the next level. 
  The infrastructure automation.  With Chef, you can automate how you build, deploy, and manage your infrastructure. Your infrastructure becomes as versionable, testable, and repeatable as application code.  Here you go... IAAC (Infrastructure as a code).
  </p>
  </div>

  <div class="large-6 columns">

  </div>
</div>

<br>

<h4><a href="#">About this tutorial</a></h4>
<p>
In this tutorial we will setup a <br>
1. Chef server <br>
2. Chef Dev Kit <br>
3. Chef Client <br>
4. Node (CloudShare.com CentOS VM) <br>
</p>
<br>

<h4><a href="#">Chef Architecture</a></h4>
<p>
Here is the architecture of Chef. 
</p>
<br>
<p>
<div class="large-12 columns">
<image src="http://technoon.github.io/lessons/images/chef.png"/>
</div>
</p>

<br>
<h4><a href="#">Elements of Chef</a></h4>
<p>
  <b>Resource</b> - Represents a piece of the system and its desired state. 
  <br>e.g. A package that should be installed ; a file which should be created
  <br>  
  <b>Recipe</b> - A Configuration file which describe resoures and their desired state. 
  <br>e.g. Install & start the software components
  <br> 
  <b>Cookbooks</b> - Fundation unit of configuration which defines a particular scenario and contains recipes, templates, files to 
  support that scenario. A scenario here could be 'Installing apache server'. 
  <br>
  <b>Nodes</b> - Represents a server within your infrastructure. Could be physical / virtual / cloud instances. Chef client application will run on 
  the nodes. 
  <br>
  <b>Run List</b> - The list of recipes which has to be executed for the given node. 
  <br>
  <b>Chef Server</b> - A centralised server which manages node configuration, cookbooks & run-list for nodes. 
  <br>
  <b>Chef Client</b> - A process which pull the chef configuration for each node from the chef server 
  <br>
  Knife - Utility to interact with chef server
  <br>
</p>
<br>

<h4><a href="#">Setup the Hosted Chef server & Dev Kit</a></h4>
<p>
For this tutorial we are goinng to use the 'Hosted Chef' option, which means the chef server will be hosted in the getchef.com, we don't need to install the chef server locally / on premise. <br> 
1. Go to getchef.com and click 'GetChef' link and select 'Hosted Chef'<br>
2. Start the free trial by filling the form and get started<br>
3. Create an Organisation<br>
4. After creating the organisation, download the starter kit. Extract the starter kit, this will create a folder 'Chec-Repo'<br>
5. This chef-repo folder contains the subfolders for cookbooks, recipes, templates & other settings<br>
</p>
<br>

<h4><a href="#">Setup the Chef Client</a></h4>
<p>
Download the Chef client at <i>"http://www.getchef.com/chef/install"</i>.  Select & download the client as per your operating system and install the 
client. This installation gives the utility called 'Knife'. This utitlity is used to interact with the Chef server. <br>
The <i>.chef></i> folder under the chef-repo folder contains the knife.rb file. This file contains the configurations about Chef server URL
<br><i>e.g chef_server_url  "https://api.opscode.com/organizations/<your_org_name>"</i>
<br>
Open the terminal or command prompt and go to 'chef-repo' folder and run the below commmand to validate the connectivity to the chef server.
The client list should give the <i>"validation_client_name"</i> in the knife.rb file. 
</p>
<br>
<div class="panel">
<pre>
knife --version
knife client list
</pre>
</div>
<br>

<h4><a href="#">Setup the Node (VM)</a></h4>
<p>
Cloudshare (partner of Chef org) gives a hosted node VM for testing the chef. This is trial VM and after few days it gets recycled. 
1. Access the URL <i>"http://opscode-cheflab.herokuapp.com/labs/learnchef/centos/attend"</i> and register with cloudshare
2. After registration click on the button 'Start Using Thish Environment'
3. Cloudshare will provision a 'CentOS' VM
4. Collect the details about the node (External address, username & password)
</p>
<br>

<div class="large-12 columns">
  <image src="http://technoon.github.io/lessons/images/chef-node.png"/>
</div>

<br><br>

<h4><a href="#">Bootstraping the Nodes</a></h4>
<p>
Bootstraping is the process through which, the following tasks are performed. <br>
1. Installation of Chef Client in the nodes<br>
2. Declaration of a name for the Node (e.g. In our case 'ChefTestNode')<br>
3. The Node details get registerd with the remote Chef Server<br><br>

<i>VM external address is the host name given by CloudShare. It looks like this 'uvo10t26kr3c72a8yeu.vm.cld.sr'
Get the username & password from the Cloudshare VM credentials.</i>
</p>
<br>

<div class="panel">
<pre>
knife bootstrap <VM external Address> -x <Username> -P <password> -N ChefTestNode

<i>Run the below command to validate the successful bootstrap. This should give <br>
the nodes registered with chef server.</i>

knife node list
</pre>
</div>
<br>


<!-- Sample Cookbook - Apache -->
<h4><a href="#">Sample Cookbook - Apache</a></h4>
<p>
Using the knife utility a cookbook can be created.  The below command creates a cookbook 'apache'. 
</p>

<div class="panel">
<pre>
knife cookbook create apache
</pre>
</div>

<br>
<div class="row">
<div class="large-6 columns">
  <image src="http://technoon.github.io/lessons/images/chef-repo-folder.png"/>
</div>

<div class="large-6 columns">
<p>
Each cookbook contains a 'recipes' folder which holds the .rb files.  These files contains the scripts for resource policies.
Edit the default.rb file under the 'recipes' folder with the below scripts. </br></br>
The package statement will install the apache, service statement will enable & start the apache server, template statement below creates a 'index.html' file under the '/var/www/html' folder with the source index.html.erb.  Create this .erb (embedded ruby) file in the 'templates/default' folder under the 'apache' cookbook.
</p>
</div>
</div>
<br>

<div class="panel">
<pre>
package "httpd" do
  action :install
end

service "httpd" do
  action [:enable, :start]
end

template "/var/www/html/index.html" do
  source "index.html.erb"
  mode "0644"
end
</pre>
</div>

<br>

<div class="panel">
<pre>
Content of the 'index.html.erb' is below. 

&lt;h1&gt;Hello Chef! &lt;/h1&gt;
</pre>
</div>

<br>

<!-- Deploying the Cookbook to Chef Server -->
<h4><a href="#">Deploying the Cookbook to Chef Server</a></h4>
<p>
Now, upload the apache cookbook into chef server. After the upload create the run-list for the Node (CentOS VM). This run-list will contain the
cookbooks for the Node which we created through the above step. 
</p>
<br>

<div class="panel">
<pre>
knife cookbook upload apache 

knife node run_list add ChefTestNode "recipe[apache]"
</pre>
</div>
<br>


<h4><a href="#">Running the Chef Client in Nodes</a></h4>
<p>
ssh into ChefTestNode VM and run the chef client. This will get the run-list from the TestNode from the chef server and execute the recipe 'apache'  
</p>
<br>
<div class="panel">
<pre>
ssh root@<your_node_name>

sudo chef-client
</pre>
</div>
<br>

<h4><a href="#">Accessing the sample html page</a></h4>
<p>
Open the browser and access the ChefTestNode e.g. uvo1m2po3z567x4rytt.vm.cld.sr  
</p>  

<p>Happy Coding !</p>
</article>
</div>

<!-- End Main Content -->



<!-- Sidebar -->
    <aside class="large-3 columns">
 
      <h5>Rajesh's Writings : </h5>
      <ul class="side-nav">
        <li><a href="http://technoon.github.io/lessons/mongodb-nodejs">Node.js & MongoDB</a></li>
        <li><a href="http://technoon.github.io/lessons/arduino">Arduino Microcontroller</a></li>
        <li><a href="http://technoon.github.io/lessons/Endeca-Cartridge-ATG-CRS">ATG-CRS Endeca Cartridge</a></li>       
        <li><a href="#">Knockout JS</a></li>
        <li><a href="#">Rasberry Pi</a></li>
      </ul>
 
      <div class="panel">
        <h5>Check ATG & Endeca Tutorials</h5>
        <p></p>
        <a href="http://technoon.github.io/lessons/EndecaCartridge_CRS">Read More →</a>
      </div>
 
    </aside>
 
    <!-- End Sidebar -->
  </div>
 
  <!-- End Main Content and Sidebar -->
  <!-- Footer -->
  <footer class="row">
    <div class="large-12 columns">
      <hr />
      <div class="row">
        <div class="large-6 columns">
          <p>© Rajeshkumar Venkatesan</p>
        </div>
        <div class="large-6 columns">
          <ul class="inline-list right">
               <li><a href="http://technoon.github.io/lessons">Home</a></li>
               <li><a href="http://linkedin.com/in/vrkrajesh">About me</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-47069620-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>    
 
  </body>
</html>
