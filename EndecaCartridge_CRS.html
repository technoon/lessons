
<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta name="keywords" content="Endeca, Cartridge, XM, Experience Manager, ATG, CRS, Commerce Reference Store, Template"/>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Technoon | How to create Endeca Cartridge for ATG CRS</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/vendor/modernizr.js"></script>
  </head>
  <body>

  <div class="row">
    <div class="large-12 columns">
      <div class="nav-bar right">
       <ul class="button-group">
         <li><a href="http://technoon.github.io/lessons/" class="small button">Home</a></li>
         <li><a href="http://linkedin.com/in/vrkrajesh/" class="small button">About me</a></li>
        </ul>
      </div>
      <h1>Technoon <small>Tutorials<br>Creating Endeca Cartridge to use in ATG CRS</small></h1>
      <hr />
    </div>
  </div>

<!-- Main Page Content and Sidebar -->
<div class="row">

<!-- Main Blog Content -->
<div class="large-9 columns" role="content">
 
<article>
<h6>Written by <a href="#">Rajeshkumar Venkatesan</a> on July, 2014.</h6>

<div class="row">
<div class="large-6 columns">
<h4><a href="#">Preface</a></h4>
<p>In this tutorial, we will see how to create a new endeca cartridge and use it in ATG CRS module.  This tutorial assumes the ATG & ATG CRS, Endeca MDEX, Endeca Platform services are installed and working good. </p>
</div>

<div class="large-6 columns">
<img src="images/ATG_CRS_Endeca.png"/>
</div>
</div>

<br>
<p>
<img src="images/PageAssembly.png"/>
</p>

<h4><a href="#">1. Creating Endeca Cartridge Template XML</a></h4>
<p>Create a folder "Hello-World" under "C:\Endeca\APPS\CRS\config\cartridge_templates" and create the below template.xml file with the new cartridge definition. Note:  This cartridge a of type "HeaderContent".  Copy the thumbnail.png & locale folder from the other existing cartridges (e.g. HeaderBanner-ATGCategory).  Update the template description in the "Resources_en" file. </p>

<div class="panel">
<pre>

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ContentTemplate xmlns="http://endeca.com/schema/content-template/2008" 
                                              type="HeaderContent"&gt;
  &lt;Description&gt;${template.description}&lt;/Description&gt;
  &lt;ThumbnailUrl&gt;thumbnail.png&lt;/ThumbnailUrl&gt;
  &lt;ContentItem&gt;
    &lt;Name&gt;Hello World&lt;/Name&gt;
    &lt;Property name="welcomeMessage"&gt;
        &lt;String/&gt;
    &lt;/Property&gt;
  &lt;/ContentItem&gt;
  &lt;EditorPanel&gt;
    &lt;BasicContentItemEditor/&gt;
  &lt;/EditorPanel&gt;
&lt;/ContentTemplate&gt;

</pre>
</div>

<br>

<h4><a href="#">2. Deploying the Cartridge templates to Endeca Workbench</a></h4>
<p>To deploy the newly created cartridge template to Endeca authoring & live run the below control script.</p>

<div class="panel">
<pre>
C:\Endeca\APPS\CRS\control\set_template.bat  
(Assuming the default Endeca Apps install location)
</pre>
</div>

<br>

<h4><a href="#">3. Validate the successful creation of Cartridge</a></h4>
<p>Login into Endeca workbench (http://localhost:8006/) and navigate to "content -> Web -> Home Pages -> Default Home Pages" and try adding the "HeaderContent" as "Hello-World" cartridge.  If you can see the "Hello-World" header content cartridge then it means the Step-1 & Step-2 above went well. </p>


<br>

<h4><a href="#">4. Creating the ATG Cartridge Components</a></h4>
<p>Now the cartridge ATG components has to be created.  Follow the below steps.  The Endeca assembler source & config files are kept in the 
C:\ATG\ATG11.0\CommerceReferenceStore\Store\Endeca\Assembler folder as default. </p>

<div class="panel">
<pre>
C:\Endeca\APPS\CRS\control\set_template.bat

(Assuming the default Endeca Apps install location)
</pre>
</div>

<p>
i) Cartridge Handler & ConentItem returned by the handler should be kept under the package atg.endeca.assembler.cartridge.handler. 
</p>

<p>
ii) Create the HelloWorldContentItem.java with the below code 
</p>

<div class="panel">
<pre>
package atg.projects.store.assembler.cartridge;

import atg.repository.RepositoryItem;
import com.endeca.infront.assembler.BasicContentItem;
import com.endeca.infront.assembler.ContentItem;

public class HelloWorldContentItem extends BasicContentItem {
  public static final String MSG_KEY = "welcomeMessage";

  public HelloWorldContentItem(ContentItem pConfig) {
    super(pConfig);
  }

  public String getWelcomeMessage() {
    return getTypedProperty(MSG_KEY);
  }

  public void setWelcomeMessage(String pWelMsg) {
    put(MSG_KEY, pWelMsg);
  }
}
</pre>
</div>

<p>
iii) Create the HelloWorldCartridgeHandler.java with the below code.  Also create the HelloWorldCartridgeHandler.properties (component) which refers the handler source.
</p>

<div class="panel">
<pre>
package atg.projects.store.assembler.cartridge.handler;

import atg.core.util.StringUtils;
import atg.endeca.assembler.AssemblerTools;
import atg.projects.store.assembler.cartridge.HelloWorldContentItem;
import com.endeca.infront.assembler.BasicContentItem;
import com.endeca.infront.assembler.CartridgeHandlerException;
import com.endeca.infront.assembler.ContentItem;
import com.endeca.infront.assembler.AbstractCartridgeHandler;

public class HelloWorldCartridgeHandler extends AbstractCartridgeHandler {
 
  public HelloWorldContentItem process(ContentItem pCartridgeConfig) 
            throws CartridgeHandlerException {

    HelloWorldContentItem helloWorldItem = 
                new HelloWorldContentItem(pCartridgeConfig);
    helloWorldItem.setWelcomeMessage("Hello World !");
    return categoryItem;

  }
}
</pre>
</div>

<p>
Also, create a Hello World Handlder component using the below properties file.
</P>

<div class="panel">
<pre>
C:\ATG\ATG11.0\CommerceReferenceStore\Store\Endeca\Assembler\src\
        config\atg\endeca\assembler\cartridge\handler\HelloWorld.properties


$class=atg.projects.store.assembler.cartridge.handler.HelloWorldCartridgeHandler
$scope=prototype
</pre>
</div>

<br>
<p>
iv) A cartridge handler should be mapped to a corresponding Renderer (HelloWorldCartridgeRenderer). Ideally renderers are JSPs. Copy the below JSP renderer into the j2ee-apps\Storefront\store.war\cartridges\Hello-World folder.  Where Hello-World is a newly created folder. 
</p>

<br>

<p>
v) Finally map Cartridge to CartridgeHandler component.  
</p>

<div class="panel">
<pre>
CommerceReferenceStore\Store\Endeca\Assembler\src\config\atg\
                  endeca\assembler\NucleusAssemblerFactory.properties

Hello-World=/atg/endeca/assembler/cartridge/handler/HelloWorld
</pre>
</div>


<h4><a href="#">5. Compiling the ATG Cartridge Components</a></h4>
<p>The default build.xml to compile the assembler java codes is already in the "C:\ATG\ATG11.0\CommerceReferenceStore\Store\Endeca\Assembler" folder.  
Make sure you have the DYNAMO_HOME & DAS_ROOT environment variables set appropriately.</p>

<div class="panel">
<pre>
DYNAMO_HOME=C:\ATG\ATG11.0\home
DAS_ROOT=C:\ATG\ATG11.0\DAS
</pre>
</div>

<p>
Also, install the ANT and set the ANT_HOME environment variable as appropriate and run the build just by typing "ant" in the below folder location. 
This will compile all the java class created through the previous section.</P>

<div class="panel">
<pre>
C:\ATG\ATG11.0\CommerceReferenceStore\Store\Endeca\Assembler>ant
</pre>
</div>

<p>
Note: During the final EAR build, ATG runassembler will create a classes.jar & config.jar including the newly created class files. (Refer the MANIFEST.MF)
</p>


<h4><a href="#">6. Creating a template</a></h4>
<p>
i) Lets create a page which uses this newly created Hello-World HeaderContent cartridge. Create the "HelloWorld" page folder (make sure to change the Folder Type to 'Page') and then create a default landing page.  
For this "Default HelloWorld Page" assign the existing "OneColumnPage" template by selecting from the list.  Refer the below picture. 
</p>

<p>
<image src="http://technoon.github.io/lessons/images/Endeca_XM.png"/>
</p>

<p>
ii) Assign the "Hello-World" headercontent cartridge as the HeaderContent for the "Default HelloWorld Page". You can also assign "Scrolling Products" cartridge as the MainContent, but it is optional you can leave this empty.
</p>


<h4><a href="#">7. Deploy template configuration from Authoring to Live</a></h4>
<p>
To deploy the newly created cartridge template to Endeca authoring & live run the below control script.
</p>

<div class="panel">
<pre>
C:\Endeca\APPS\CRS\control\promote_content.bat
</pre>
</div>


<h4><a href="#">8. Using the cartridge in JSP</a></h4>
<p>
Write a simple JSP which uses the "InvokeAssembler" droplet to get the page configuration from Endeca MDEX.  Use the below JSP code to create 
a HelloWorld.jsp. Copy this JSP into the browse folder in "store.war".  You may need to create the ATGProduction.ear file with this newly added JSP. Otherwise, copy this JSP directly into the browse folder in ATGProduction.ear under Weblogic domain.
</p>

<div class="panel">
<pre>
&lt;dsp:page&gt;
    &lt;dsp:importbean bean="/atg/endeca/assembler/droplet/InvokeAssembler"/&gt;

    &lt;dsp:droplet name="InvokeAssembler"&gt;
      &lt;dsp:param name="contentCollection" value="/content/Web/HelloWorld Pages"/&gt;
      &lt;dsp:oparam name="output"&gt;
        &lt;dsp:getvalueof var="HelloContent" 
            vartype="com.endeca.infront.assembler.ContentItem" param="contentItem" /&gt;
      &lt;/dsp:oparam&gt;
    &lt;/dsp:droplet&gt;
  
  &lt;c:if test="${not empty HelloContent}"&gt;
    &lt;dsp:renderContentItem contentItem="${HelloContent}" /&gt;
  &lt;/c:if&gt;
&lt;/dsp:page&gt;
</pre>
</div>

<br>

<p>Access this JSP as "http://localhost:7003/crs/storeus/browse/HelloWorld.jsp"
7003 is the http port of the running ATG CRS instance. 
</p>

<br>
<p>Happy Coding !</p>
</article>
</div>

<!-- End Main Content -->
 
<!-- Sidebar -->
    <aside class="large-3 columns">
 
      <h5>Rajesh's Writings : </h5>
      <ul class="side-nav">
        <li><a href="http://technoon.github.io/lessons">Node & MongoDB</a></li>
        <li><a href="http://technoon.github.io/lessons/arduino">Arduino Microcontroller</a></li>
        <li><a href="http://technoon.github.io/lessons/EndecaCartridge_CRS">ATG CRS & Endeca Cartridge</a></li>
        <li><a href="#">Knockout JS</a></li>
        <li><a href="#">Rasberry Pi</a></li>
      </ul>
 
      <div class="panel">
        <h5>Check MongoDB Tutorials</h5>
        <p></p>
        <a href="http://technoon.github.io/lessons">Read More →</a>
      </div>
 
    </aside>
 
    <!-- End Sidebar -->
  </div>
 
  <!-- End Main Content and Sidebar -->
  <!-- Footer -->
  <footer class="row">
    <div class="large-12 columns">
      <hr />
      <div class="row">
        <div class="large-6 columns">
          <p>© Rajeshkumar Venkatesan</p>
        </div>
        <div class="large-6 columns">
          <ul class="inline-list right">
               <li><a href="http://technoon.github.io/lessons">Home</a></li>
               <li><a href="http://linkedin.com/in/vrkrajesh">About me</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-47069620-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
 
  </body>
</html>
